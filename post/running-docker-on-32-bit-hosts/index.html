<!doctype html><html class=no-js lang=en-us xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Running Docker on 32-bit Hosts"><meta name=author content><meta name=keyword content><link rel="shortcut icon" href=/favicon.ico><title>Running Docker on 32-bit Hosts &#183; Spaghetti Code with Beer</title><link rel=stylesheet href=https://nagimov.me/css/theme/united2.css><link rel=stylesheet href=https://nagimov.me/css/font-awesome.min.css><link rel=stylesheet href=https://nagimov.me/css/style.css><script>var remark_config={host:"https://remark.ngm.me",site_id:'nagimov_me',components:['embed'],theme:'light',};</script><script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script><script>(function(f,a,t,h,o,m){a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};o=f.createElement('script'),m=f.getElementsByTagName('script')[0];o.async=1;o.src=t;o.id='fathom-script';m.parentNode.insertBefore(o,m)})(document,window,'https://fathom.ngm.me/tracker.js','fathom');fathom('set','siteId','RYEFY');fathom('trackPageview');</script><link href rel=alternate type=application/rss+xml title="Spaghetti Code with Beer"></head><body lang=en><div class=container><div class=row><div class="navbar navbar-default" role=navigation><div class=navbar-header><a class=navbar-brand href=https://nagimov.me>Spaghetti Code with Beer</a></div><div class="navbar-collapse collapse navbar-responsive-collapse"><ul class="nav navbar-nav navbar-right" style=font-size:18px><li><a href=https://nagimov.me>Home</a></li><li><a href=https://nagimov.me/post/>Posts</a></li><li><a href=/about/>About</a></li></ul></div></div></div></div><div class=container><div class=row><div class=col-md-12 style=display:flex;justify-content:space-between><div><h3>Running Docker on 32-bit Hosts</h3></div><div>&nbsp;&nbsp;&nbsp;&nbsp;</div><div style=margin-bottom:10.5px;margin-top:21px><span class="label label-primary">2019-02-03</span></div></div></div><div class=row><div class=col-md-12><p>Docker is known to not to support 32-bit hosts. As per <a href=https://docs.docker.com/install/linux/docker-ce/debian>debian installation instructions</a>: <code>Docker CE is supported on x86_64 (or amd64), armhf, and arm64 architectures.</code> 32-bit hosts are unlikely to become supported either &ndash; <a href=https://github.com/moby/moby/issues/136>&ldquo;let&rsquo;s bring docker on 32-bit&rdquo; issue</a> was closed and locked back in 2014.</p><p>Nothing fundamentally prevents docker (including latest version of docker CE) from running on 32-bit platforms. I am currently running a slightly outdated version <code>18.03.0-ce</code> on a 15 years old <a href="https://www-01.ibm.com/common/ssi/cgi-bin/ssialias?infotype=AN&subtype=CA&htmlfid=897/ENUS104-011">IBM xSeries 335 server</a> with a whopping 2.8GHz Intel Xeon and 4GB of DDR RAM. It comfortably runs half a dozen containers (nginx proxies with simple API end points) and a bunch of scripts poking at various sensors.</p><p><img src=/images/ibm-xseries-335.jpg#center alt=width500px></p><p>The server only supports IDE drives and I had to use a floppy diskette to sideload firmware for the network card (USB port wasn&rsquo;t recognized by debian installer). This particular server been in 24/7 operation since its birth, with a brief interruption for two years in 2013-2014, when its ownership has changed (I picked it from the scrap yard, along with two complete replacement spares). Check out this boot animation from early 2000&rsquo;s:</p><p><img src=/images/ibm-xseries-335-boot-diskette.gif#center alt=width300px></p><p>There are obviously no official docker builds for 32-bit platforms, but <a href=https://github.com/mforkel/docker-ce-i386>this fork</a> supports building i386 docker. It is slightly outdated (<code>18.03.0-ce</code> as of February 2019), albeit I can&rsquo;t remember any sweet features released since then anyways.</p><p>The build scripts themselves require a 64-bit environment, so if you can build docker on a 64-bit platform first, the recipe should work as-is.</p><p>I decided to complicate things further and run the installation entirely on a 32-bit system, so there are few changes to the recipe.</p><h4 id=prerequisites>Prerequisites</h4><ul><li>debian 9.5.0 32-bit installed</li><li>apt repositories configured with network mirrors</li><li><code>sudo</code>, <code>git</code> and <code>build-essential</code> installed in addition to bare debian image</li></ul><h4 id=installing-docker-io>Installing <code>docker-io</code></h4><p>The above mentioned docker build scripts use an existing docker installation. So if we want to build docker for a 32-bit platform, we have to have docker installed for the build (<code>WinRAR.rar</code>, anyone?)</p><p>As hopeless as it sounds, there is a way out. <code>Docker.io</code> package from <code>jessie-backports</code> <em>can</em> run on 32-bit hosts, even though there is a big red flag in the <a href=https://packages.debian.org/jessie-backports/docker.io>description</a>: <code>Using docker.io on non-amd64 hosts is not supported at this time. Please be careful when using it on anything besides amd64.</code> We won&rsquo;t use it in production, and it works fine as a build environment.</p><p>Install the package:</p><ul><li>add <code>deb https://deb.debian.org/debian jessie-backports main</code> to your apt sources in <code>/etc/apt/sources.list</code></li><li>update the package index: <code>sudo apt-get update</code></li><li>install the <code>docker.io</code> package: <code>sudo apt-get -t jessie-backports install docker.io</code></li><li>check the version of docker binary: <code>docker -v</code> (outputs <code>Docker version 1.6.2, build 7c8fca2</code>)</li></ul><h4 id=building-32-bit-docker-from-sources>Building 32-bit docker from sources</h4><p>Now is the time to install a relatively fresh version of docker from <a href=https://github.com/mforkel/docker-ce-i386>this magic repo</a>.</p><p>Clone the repo:</p><ul><li><code>cd /tmp</code></li><li><code>git clone https://github.com/mforkel/docker-ce-i386</code></li><li><code>cd docker-ce-i386</code></li></ul><p>Depending from the state of this repository, you might need to switch the branch, e.g. <code>git checkout 18.03-i386</code>, depending from what versions are currently available. I used the latest commit available as of February, 2019:</p><ul><li><code>git checkout c68b084</code></li></ul><p>The build script assumes that a relatively fresh version of docker is available. Our <code>docker.io</code> is from 2015, and it doesn&rsquo;t support <code>ARG</code> Dockerfiles parameters. That&rsquo;s an easy fix:</p><ul><li><code>sed -i "s/ARG APT_MIRROR=deb.debian.org/# ARG APT_MIRROR=deb.debian.org/" ./components/engine/contrib/builder/deb/i386/debian-stretch/Dockerfile</code></li><li><code>sed -i "s/\$APT_MIRROR/deb.debian.org/" ./components/engine/contrib/builder/deb/i386/debian-stretch/Dockerfile</code></li><li><code>sed -i "s/ARG APT_MIRROR=deb.debian.org/# ARG APT_MIRROR=deb.debian.org/" ./components/packaging/deb/debian-stretch/Dockerfile.i386</code></li><li><code>sed -i "s/\$APT_MIRROR/deb.debian.org/g" ./components/packaging/deb/debian-stretch/Dockerfile.i386</code></li></ul><p>The build script also uses an official <code>alpine</code> image from dockerhub, which is 64-bit. We need to replace it with <code>i386/alpine</code>:</p><ul><li><code>sed -i "s/alpine/i386\/alpine/" ./components/packaging/deb/Makefile</code></li></ul><p>Now is finally the time to run the build:</p><ul><li><code>sudo ARCH=i386 DOCKER_BUILD_PKGS=debian-stretch make deb</code></li></ul><p>Make sure that a newly built <code>*.deb</code> package is present:</p><ul><li><code>ls ./components/packaging/deb/debbuild/debian-stretch/</code></li></ul><p>Remove old docker installation:</p><ul><li><code>sudo apt-get remove docker.io</code></li></ul><p>Install the newly built <code>*.deb</code> package:</p><ul><li><code>sudo dpkg -i ./components/packaging/deb/debbuild/debian-stretch/docker-ce_18.03.0~ce-0~debian_i386.deb</code></li><li><code>sudo apt-get install -f</code></li></ul><p>We&rsquo;re done:</p><ul><li><code>docker -v</code> outputs <code>Docker version 18.03.0-ce, build c68b084381</code></li><li><code>sudo docker run hello-world</code> successfully pulls and runs the test image</li></ul><h4 id=getting-32-bit-docker-compose>Getting 32-bit docker-compose</h4><p>Thankfully, 32-bit package of <code>docker-compose</code> is available from <a href=https://launchpad.net/ubuntu/xenial/i386/docker-compose/1.8.0-2~16.04.1>this Ubuntu Xenial repository</a>, so installation is as simple as:</p><ul><li><code>cd /tmp</code></li><li><code>wget https://launchpadlibrarian.net/314562376/docker-compose_1.8.0-2~16.04.1_all.deb</code></li><li><code>sudo dpkg -i docker-compose_1.8.0-2~16.04.1_all.deb</code></li><li><code>sudo apt-get install -f</code></li><li><code>docker-compose --version</code> outputs <code>docker-compose version 1.8.0, build unknown</code></li></ul><h4 id=living-with-docker-on-32-bit-hosts>Living with docker on 32-bit hosts</h4><p>Bear in mind, this isn&rsquo;t the end of a weird journey. Overwhelming majority of images from dockerhub are built with 64-bit binaries (see the above mentioned official <code>alpine</code> image), so there will be complications. E.g., the very popular <a href=https://github.com/jwilder/nginx-proxy>nginx-proxy</a> image is built with 64-bit builds of both <a href=https://github.com/jwilder/docker-gen>docker-gen</a> and <a href=https://github.com/jwilder/forego>forego</a>, and is based on official <code>nginx:1.11.10</code> image which in turn is based on official 64-bit <code>debian:jessie</code> image. The following changes would make it usable on 32-bit hosts:</p><ul><li>replace docker-gen binary (i386 builds are available from <a href=https://github.com/jwilder/docker-gen/releases>releases</a>)</li><li>replace forego binary (i386 build can be found <a href=https://dl.equinox.io/ddollar/forego/stable/archive>here</a>)</li><li>bump nginx version to <code>nginx:1.14</code> &ndash; it is based on 32-bit <code>debian:stretch-slim</code></li></ul><p>Another example &ndash; must-have sibling of nginx-proxy, <a href=https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion>letsencrypt-nginx-proxy-companion</a>, is based on official 64-bit <code>alpine</code> image and uses <a href=https://github.com/jwilder/docker-gen>docker-gen</a> as well, therefore:</p><ul><li>replace <code>alpine</code> with <code>i386/alpine</code></li><li>replace <code>docker-gen</code> binary with i386 version</li></ul><p>&mldr;and so on. Some images of course are simply not worth porting back to the 32-bit world, and docker on 32-bit platforms is only worth using for simple images, but hey, that&rsquo;s 90% of my use-cases anyways :)</p><hr></div></div><div class=row><div class=col-md-12 style=display:flex;justify-content:space-between><div>Tagged
#<a href=/tags/docker>docker</a>
,
#<a href=/tags/docker-compose>docker-compose</a>
,
#<a href=/tags/nginx-proxy>nginx-proxy</a>
,
#<a href=/tags/letsencrypt>letsencrypt</a>
,
#<a href=/tags/32-bit>32-bit</a>
,
#<a href=/tags/64-bit>64-bit</a>
,
#<a href=/tags/x86>x86</a>
,
#<a href=/tags/x86_64>x86_64</a>
,
#<a href=/tags/i386>i386</a>
,
#<a href=/tags/i686>i686</a>
,
#<a href=/tags/amd64>amd64</a>
,
#<a href=/tags/alpine>alpine</a>
,
#<a href=/tags/debian>Debian</a>
,
#<a href=/tags/jessie>Jessie</a>
,
#<a href=/tags/stretch>Stretch</a>
,
#<a href=/tags/ubuntu>Ubuntu</a>
,
#<a href=/tags/xenial>Xenial</a></div><div><span class="label label-primary">2019-02-03</span></div></div></div><div class=row><div class=col-md-12><hr></div></div><div class=row><div class=col-md-12><div id=remark42></div></div></div></div><div class=container><div class="row col-md-12"><footer><div class=pull-left><p>&copy; 2021 Ruslan Nagimov ~ Powered By <a href=https://gohugo.io>Hugo</a> ~ <a href=https://creativecommons.org/licenses/by/4.0/>License: CC BY 4.0</a></p></div><div class=pull-right><a href=https://github.com/nagimov target=_blank><i class="fa fa-github-square fa-2x"></i></a></div></footer></div></div></body></html>